/*
This class has been generated by the Code Generator
 */

package com.msig.masterdata;

import java.util.Date;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.DMLStatement;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.cordys.cpc.bsf.busobject.StoredProcedure;
import com.eibus.util.logger.CordysLogger;
import com.eibus.util.system.Native;

public class MSIG_APPROVAL_MATRIX_HEADER extends
MSIG_APPROVAL_MATRIX_HEADERBase {
	
	private static CordysLogger logger = CordysLogger.getCordysLogger(MSIG_APPROVAL_MATRIX_HEADER.class);
	
	public MSIG_APPROVAL_MATRIX_HEADER() {
		this((BusObjectConfig)null);
	}

	public MSIG_APPROVAL_MATRIX_HEADER(BusObjectConfig config) {
		super(config);
	}

	@ Override
	public void onBeforeInsert() {
		super.onBeforeInsert();
		this.setAPR_MATRIX_HDR_ID(Native.createGuid());
		this.setCREATED_BY(MasterDataUtil.getUserName());
		this.setMODIFIED_BY(MasterDataUtil.getUserName());
		this.setCREATED_ON(new Date());
		this.setMODIFIED_ON(new Date());
	}

	@ Override
	public void onBeforeUpdate() {
		super.onBeforeUpdate();
		this.setMODIFIED_BY(MasterDataUtil.getUserName());
		this.setMODIFIED_ON(new Date());
	}

	public static BusObjectIterator < com.msig.masterdata.MSIG_APPROVAL_MATRIX_HEADER > getHeaderObjsForBranchLOBProductAndBusFunctionSP(
			String BRANCH_CODE, String LOB_CODE, String PRODUCT_CODE,
			String BUSINESS_FUNCTION, String APPLICATION) {

		StoredProcedure sp = new StoredProcedure("getApprovalMatrixHeader");
		sp.prepareCall(":ReturnValue = getApprovalMatrixHeader(:Branch, :LOB, :Product, :BusFunction, :Application)");
		
		sp.setParameter("Branch", BRANCH_CODE);
		sp.setParameter("LOB", LOB_CODE);
		sp.setParameter("Product", PRODUCT_CODE);
		sp.setParameter("BusFunction", BUSINESS_FUNCTION);
		sp.setParameter("Application", APPLICATION);
		sp.setReturnParameter("ReturnValue");
		
		sp.execute();
		
		String rValue = sp.getString("ReturnValue");
		
		//logger.error("RETURN VALUE: " + rValue);
		
		return null;
	}

	public static BusObjectIterator < com.msig.masterdata.MSIG_APPROVAL_MATRIX_HEADER > getHeaderObjsForBranchLOBProductAndBusFunction(
			String BRANCH_CODE, String LOB_CODE, String PRODUCT_CODE,
			String BUSINESS_FUNCTION, String APPLICATION) {

		String queryText = "SELECT * FROM MSIG_APPROVAL_MATRIX_HEADER "
				+ "WHERE BRANCH_CODE LIKE :BRANCH_CODE AND LOB_CODE LIKE :LOB_CODE "
				+ "AND PRODUCT_CODE LIKE :PRODUCT_CODE AND "
				+ "BUSINESS_FUNCTION LIKE :BUSINESS_FUNCTION AND APPLICATION = :APPLICATION ORDER BY CREATED_ON DESC";

		String BRANCH_CODE1 = "%" + BRANCH_CODE + "%";
		String LOB_CODE1 = "%" + LOB_CODE + "%";
		String PRODUCT_CODE1 = "%" + PRODUCT_CODE + "%";

		QueryObject query = new QueryObject(queryText);
		query.addParameter("APPLICATION", "MSIG_APPROVAL_MATRIX_HEADER.APPLICATION", QueryObject.PARAM_STRING, APPLICATION);
		query.addParameter("BRANCH_CODE", "MSIG_APPROVAL_MATRIX_HEADER.BRANCH_CODE", QueryObject.PARAM_STRING, BRANCH_CODE1);
		query.addParameter("LOB_CODE", "MSIG_APPROVAL_MATRIX_HEADER.LOB_CODE", QueryObject.PARAM_STRING, LOB_CODE1);
		query.addParameter("PRODUCT_CODE", "MSIG_APPROVAL_MATRIX_HEADER.PRODUCT_CODE", QueryObject.PARAM_STRING, PRODUCT_CODE1);
		query.addParameter("BUSINESS_FUNCTION", "MSIG_APPROVAL_MATRIX_HEADER.BUSINESS_FUNCTION", QueryObject.PARAM_STRING, BUSINESS_FUNCTION);

		query.setResultClass(MSIG_APPROVAL_MATRIX_HEADER.class);
		BusObjectIterator < com.msig.masterdata.MSIG_APPROVAL_MATRIX_HEADER > objects = query.getObjects();

		if (objects != null && !objects.hasMoreElements()) {

			objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects(BRANCH_CODE, LOB_CODE, "ANY", BUSINESS_FUNCTION, APPLICATION);

			if (objects != null && !objects.hasMoreElements()) {
				objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects(BRANCH_CODE, "ANY", PRODUCT_CODE, BUSINESS_FUNCTION, APPLICATION);

				if (objects != null && !objects.hasMoreElements()) {
					objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects("ANY", LOB_CODE, PRODUCT_CODE, BUSINESS_FUNCTION, APPLICATION);

					if (objects != null && !objects.hasMoreElements()) {
						objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects("ANY", "ANY", PRODUCT_CODE, BUSINESS_FUNCTION, APPLICATION);

						if (objects != null && !objects.hasMoreElements()) {
							objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects("ANY", LOB_CODE, "ANY", BUSINESS_FUNCTION, APPLICATION);

							if (objects != null && !objects.hasMoreElements()) {
								objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects(BRANCH_CODE, "ANY", "ANY", BUSINESS_FUNCTION, APPLICATION);

								if (objects != null && !objects.hasMoreElements()) {
									objects = MSIG_APPROVAL_MATRIX_HEADER._getHeaderObjects("ANY", "ANY", "ANY", BUSINESS_FUNCTION, APPLICATION);

									if (objects != null && !objects.hasMoreElements()) {
										return null;
									} else {
										return objects;
									}
								} else {
									return objects;
								}
							} else {
								return objects;
							}
						} else {
							return objects;
						}
					} else {
						return objects;
					}
				} else {
					return objects;
				}
			} else {
				return objects;
			}

		} else if (objects != null) {
			return objects;
		}
		return null;
	}

	private static BusObjectIterator < com.msig.masterdata.MSIG_APPROVAL_MATRIX_HEADER > _getHeaderObjects(String BRANCH_CODE, String LOB_CODE, String PRODUCT_CODE, String BUSINESS_FUNCTION, String APPLICATION) {

		String queryText = "SELECT * FROM MSIG_APPROVAL_MATRIX_HEADER "
				+ "WHERE BRANCH_CODE LIKE :BRANCH_CODE AND LOB_CODE LIKE :LOB_CODE "
				+ "AND PRODUCT_CODE LIKE :PRODUCT_CODE AND "
				+ "BUSINESS_FUNCTION LIKE :BUSINESS_FUNCTION AND APPLICATION = :APPLICATION ORDER BY CREATED_ON DESC";

		BRANCH_CODE = "%" + BRANCH_CODE + "%";
		LOB_CODE = "%" + LOB_CODE + "%";
		PRODUCT_CODE = "%" + PRODUCT_CODE + "%";

		QueryObject query = new QueryObject(queryText);
		query.addParameter("APPLICATION", "MSIG_APPROVAL_MATRIX_HEADER.APPLICATION", QueryObject.PARAM_STRING, APPLICATION);
		query.addParameter("BRANCH_CODE", "MSIG_APPROVAL_MATRIX_HEADER.BRANCH_CODE", QueryObject.PARAM_STRING, BRANCH_CODE);
		query.addParameter("LOB_CODE", "MSIG_APPROVAL_MATRIX_HEADER.LOB_CODE", QueryObject.PARAM_STRING, LOB_CODE);
		query.addParameter("PRODUCT_CODE", "MSIG_APPROVAL_MATRIX_HEADER.PRODUCT_CODE", QueryObject.PARAM_STRING, PRODUCT_CODE);
		query.addParameter("BUSINESS_FUNCTION", "MSIG_APPROVAL_MATRIX_HEADER.BUSINESS_FUNCTION", QueryObject.PARAM_STRING, BUSINESS_FUNCTION);

		query.setResultClass(MSIG_APPROVAL_MATRIX_HEADER.class);
		BusObjectIterator < com.msig.masterdata.MSIG_APPROVAL_MATRIX_HEADER > objects = query.getObjects();

		return objects;
	}

	public static BusObjectIterator<PRODUCT_DETAILS> getProductsForLOB(String LOB_CODE) {
		String queryText = "SELECT DISTINCT PRODUCT_TYPE, PRODUCT_NAME, LOB_CODE FROM PRODUCT_DETAILS, MSIG_LOB_MASTER"
				+ " WHERE LOB_CODE = :LOB_CODE AND (BMS_LOB = :LOB_CODE OR CMS_LOB = :LOB_CODE)";

		QueryObject query = new QueryObject(queryText);
		query.addParameter("LOB_CODE", "MSIG_LOB_MASTER.LOB_CODE", QueryObject.PARAM_STRING, LOB_CODE);

		query.setResultClass(PRODUCT_DETAILS.class);

		return query.getObjects();
	}

	public static BusObjectIterator<MSIG_LOB_MASTER> getDistinctProducts() {
		String queryText = "SELECT DISTINCT PRODUCT_TYPE, PRODUCT_NAME FROM PRODUCT_DETAILS";

		QueryObject query = new QueryObject(queryText);		
		query.setResultClass(MSIG_LOB_MASTER.class);

		return query.getObjects();
	}
	
	public static void deleteHeader(String headerId) {
		String queryText = "DELETE FROM MSIG_APPROVAL_MATRIX_HEADER WHERE APR_MATRIX_HDR_ID = :HEADER_ID";
		
		DMLStatement st = new DMLStatement(queryText);
		st.addParameter("HEADER_ID", "MSIG_APPROVAL_MATRIX_HEADER.APR_MATRIX_HDR_ID", headerId);
		
		st.executeDML();
	}
}
